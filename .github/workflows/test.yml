name: Change version in packages

on:
  create:
  push:
    branches:
      - 'release/**'
      - 'hotfix/**'

jobs:
  change-version:
    name: "Change version in packages"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Filter changes and update versions
        if: (startsWith(github.ref, 'refs/heads/release/') ||
             startsWith(github.ref, 'refs/heads/hotfix/'))
        run: |
          # Get the branch name
          branch_name=$(echo "${{ github.ref }}" | cut -d'/' -f3-)

          # Find all packages.json files and update versions
          find . -name "packages.json" -path "./packages/*/packages.json" | while read file; do
            # Update the version in packages.json
            sed -i "s/\"version\": \"2.5.0\"/\"version\": \"$branch_name\"/" "$file"
          done
          cat ./packages/*/packages.json
